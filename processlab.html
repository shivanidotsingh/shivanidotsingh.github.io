<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>process lab</title>
<meta name="description" content="process lab" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='86'>ð“†‰</text></svg>">

<style>
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    background: #fff;
    color: #000;
    font: 14px/1.4 system-ui, -apple-system, Arial, sans-serif;
    overflow: hidden; /* no scroll */
  }

  .wrap { display: grid; grid-template-rows: auto 1fr; height: 100vh; }
  header { padding: 8px 12px; color: #555; border-bottom: 1px solid #e5e5e5; }
  header .sub { color: #666; font-size: 13px; }

  :root{
    --grid: 16px;                
    --grid-line: #e9e9e9;         
    --hole-pad-x: 48px;          
    --hole-pad-y: 12px;        
  }

  .stage{
    position: relative;
    overflow: hidden;
    background:
      repeating-linear-gradient(
        to right,
        var(--grid-line) 0 1px,
        transparent 1px var(--grid)
      ),
      repeating-linear-gradient(
        to bottom,
        var(--grid-line) 0 1px,
        transparent 1px var(--grid)
      );
    background-position: 0 0; 
    image-rendering: pixelated;      
  }

  #canvas { position: relative; width: 100%; height: 100%; }

  .tile{
    position: absolute;
    background: #fff;
  }
  .tile img{
    display:block; width:100%; height:100%; object-fit:contain;
  }

  .focus{
    position:absolute; background:transparent;
  }
  .focus img{
    display:block; width:100%; height:100%; object-fit:contain; background:transparent;
  }
</style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="sub">behind the scenes of collaboration, and other cuttings from the work desk.</div>
    </header>

    <main class="stage" id="stage">
      <div id="canvas">
        <figure class="focus" id="focusCard"><img id="focusImg" alt=""></figure>
        <!-- thumbnails injected here -->
      </div>
    </main>
  </div>

  <script>
  const IMAGES = [
    "images/process/ADT vision.png",
    "images/process/BMC - design.png",
    "images/process/criteriaforintake.png",
    "images/process/CRM.png",
    "images/process/gaps.png",
    "images/process/ladder.jpg",
    "images/process/ideally.jpg",
    "images/process/curriculum.png",
    "images/process/Datapoints.png",
    "images/process/GNC learning.png",
    "images/process/humaneval.png",
    "images/process/knowledge sharing.png",
    "images/process/Laddering Data.jpg",
    "images/process/manual.png",
    "images/process/medium is msg.png",
    "images/process/Name Parameters.png",
    "images/process/naming systems.png",
    "images/process/ourresources.png",
    "images/process/opp.png",
    "images/process/Persona.jpg",
    "images/process/playground UI.png",
    "images/process/Product Partnerships Data Knowledge.png",
    "images/process/Reach.png",
    "images/process/Reachout if.png",
    "images/process/Rules.png",
    "images/process/scales of a problem.png",
    "images/process/signals.png",
    "images/process/singlesource of truth.png",
    "images/process/dreaming sensing.png",
    "images/process/timeline.png",
    "images/process/types of slides.png",
    "images/process/vendorgrid.png",
    "images/process/whatwedonose.png",
    "images/process/XCapit.png",
    "images/process/x.png"
  ];

  const stage    = document.getElementById('stage');
  const canvas   = document.getElementById('canvas');
  const focusEl  = document.getElementById('focusCard');
  const focusImg = document.getElementById('focusImg');

  const GRID = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--grid')) || 16;

  /* Use grid multiples only */
  const THUMB_W   = gridMul(8);   // 8 * 16 = 128px
  const EDGE_TL   = gridMul(0.5); // 8px
  const EDGE_RB   = gridMul(1);   // 16px
  const GAP       = gridMul(0.5); // 8px
  const HOLE_PAD_X= px('--hole-pad-x');
  const HOLE_PAD_Y= px('--hole-pad-y');

  let metas = [];
  let current = -1;

  Promise.all(IMAGES.map(loadMeta)).then(_metas=>{
    metas = _metas;
    layout();
    setFocus(randInt(0, IMAGES.length-1));
    window.addEventListener('resize', ()=>{ layout(); setFocus(current); });
  });

  function loadMeta(src){
    return new Promise(res=>{
      const img=new Image();
      img.onload=()=>res({src, a:(img.naturalHeight||1000)/(img.naturalWidth||1000)});
      img.onerror=()=>res({src, a:1});
      img.src=encodeURI(src);
    });
  }

  function px(varName){
    const v = getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
    return parseFloat(v);
  }
  function snap(v){ return Math.round(v / GRID) * GRID; }
  function gridMul(n){ return Math.round(n * GRID); }
  function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }
  function overlap(a,b,g){
    return !(a.x + a.w + g <= b.x ||
             b.x + b.w + g <= a.x ||
             a.y + a.h + g <= b.y ||
             b.y + b.h + g <= a.y);
  }
  function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

  function layout(){
    // wipe thumbs
    [...canvas.querySelectorAll('.tile')].forEach(n=>n.remove());

    const W = stage.clientWidth;
    const H = stage.clientHeight;

    // Focus box: width snaps (<= 720), height snaps (landscape-ish)
    let fw = Math.min(720, W - gridMul(2.5)); // leave some breath
    fw = snap(fw);
    let fh = Math.min(H - gridMul(5.5), fw * 0.75);
    fh = snap(Math.max(GRID, fh));

    // Center â†’ then snap â†’ then clamp within edges
    let fx = snap((W - fw)/2);
    let fy = snap((H - fh)/2);
    fx = clamp(fx, EDGE_TL, Math.max(EDGE_TL, W - fw - EDGE_RB));
    fy = clamp(fy, EDGE_TL, Math.max(EDGE_TL, H - fh - EDGE_RB));

    // Set focus figure box (exact multiples)
    focusEl.style.left   = fx + 'px';
    focusEl.style.top    = fy + 'px';
    focusEl.style.width  = fw + 'px';
    focusEl.style.height = fh + 'px';

    // Build a snapped keep-out hole
    const hole = {
      x: snap(fx - HOLE_PAD_X),
      y: snap(fy - HOLE_PAD_Y),
      w: snap(fw + HOLE_PAD_X*2),
      h: snap(fh + HOLE_PAD_Y*2)
    };

    // Place snapped thumbnails
    const placed = [];
    metas.forEach((m,i)=>{
      const TH = snap(Math.max(GRID, THUMB_W * (m.a || 1))); // snap height too

      let tries=0, ok=false, x=0, y=0;
      while(!ok && tries<800){
        x = clamp(snap(randInt(EDGE_TL, Math.max(EDGE_TL, W - THUMB_W - EDGE_RB))), EDGE_TL, W - THUMB_W - EDGE_RB);
        y = clamp(snap(randInt(EDGE_TL, Math.max(EDGE_TL, H - TH - EDGE_RB))), EDGE_TL, H - TH - EDGE_RB);

        const cand = {x, y, w: THUMB_W, h: TH};
        ok = !overlap(cand, hole, GAP) &&
             placed.every(p => !overlap(cand, p, GAP));
        tries++;
      }
      placed.push({x, y, w: THUMB_W, h: TH});

      const fig = document.createElement('figure');
      fig.className = 'tile';
      fig.style.left   = x  + 'px';
      fig.style.top    = y  + 'px';
      fig.style.width  = THUMB_W + 'px';
      fig.style.height = TH + 'px';
      fig.dataset.index = i;

      const im = document.createElement('img');
      im.alt = `img ${i+1}`;
      im.src = encodeURI(m.src);
      fig.appendChild(im);

      fig.addEventListener('click', ()=> setFocus(i));
      canvas.appendChild(fig);
    });
  }

  function setFocus(i){
    current = ((i % metas.length) + metas.length) % metas.length;
    const m = metas[current];
    focusImg.src = encodeURI(m.src);
    focusImg.alt = `image ${current+1}`;
    // no reflow required; the focus box is already aligned and snapped
  }
  </script>
</body>
</html>
