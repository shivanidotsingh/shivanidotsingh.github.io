<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>making of the sausage</title>
  <meta name="description" content="artefacts from work - out of context." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='86'>âœ§</text></svg>">
  <style>
    :root { --gap: 28px; --pad: 120px; --colw: 420px; /* column width */ }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; background: #000; color: #fff; font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; }

    /* 2D scrollable viewport */
    #viewport { position: fixed; inset: 0; overflow: auto; }
    #canvas { position: relative; width: 6000px; height: 4000px; /* will be resized by JS */ }

    /* tiles */
    .tile { position: absolute; user-select: none; -webkit-user-drag: none; touch-action: none; }
    .tile img { display: block; width: 100%; height: auto; }
  </style>
</head>
<body>
  <div id="viewport" aria-label="Masonry canvas"><div id="canvas"></div></div>

  <script>
    const IMAGES = [
      "images/process/ADT vision.png",
      "images/process/Concentric.png",
      "images/process/criteriaforintake.png",
      "images/process/CRM.png",
      "images/process/cryptotransfer.png",
      "images/process/curriculum.png",
      "images/process/Datapoints.png",
      "images/process/GNC learning.png",
      "images/process/humaneval.png",
      "images/process/knowledge sharing.png",
      "images/process/Laddering Data.jpg",
      "images/process/manual.png",
      "images/process/medium is msg.png",
      "images/process/Name Parameters.png",
      "images/process/naming systems.png",
      "images/process/ORG.png",
      "images/process/ourresources.png",
      "images/process/opp.png",
      "images/process/Persona.jpg",
      "images/process/playground UI.png",
      "images/process/Product Partnerships Data Knowledge.png",
      "images/process/Reach.png",
      "images/process/Reachout if.png",
      "images/process/Rules.png",
      "images/process/scales of a problem.png",
      "images/process/timeline.png",
      "images/process/types of slides.png",
      "images/process/vendorgrid.png",
      "images/process/whatwedonose.png",
      "images/process/why-how.png",
      "images/process/XCapit.png"
    ];

    // ---- util helpers ----
    const $ = sel => document.querySelector(sel);

    const viewport = $('#viewport');
    const canvas = $('#canvas');

    // Layout settings
    const GAP = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gap')) || 28;
    const PAD = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--pad')) || 120;
    const COL_W = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--colw')) || 420;
    const COLS = 14; // make it wide so you can scroll horizontally

    function preload(src) {
      return new Promise((resolve) => {
        const img = new Image();
        img.loading = 'eager';
        img.decoding = 'async';
        img.onload = () => resolve({ src, w: img.naturalWidth, h: img.naturalHeight });
        img.onerror = () => resolve(null);
        img.src = encodeURI(src);
      });
    }

    function layout(items) {
      const heights = new Array(COLS).fill(PAD);
      let maxRight = PAD, maxBottom = PAD;

      items.forEach((it, i) => {
        if (!it) return;
        const isPortrait = it.h > it.w;
        const targetW = isPortrait ? Math.min(300, COL_W) : COL_W; // fixed width for portraits
        const scale = targetW / it.w;
        const targetH = Math.round(it.h * scale);

        const col = heights.indexOf(Math.min(...heights));
        const x = PAD + col * (COL_W + GAP);
        const y = heights[col];
        heights[col] += targetH + GAP;

        const fig = document.createElement('figure');
        fig.className = 'tile';
        fig.style.width = targetW + 'px';
        fig.style.left = x + 'px';
        fig.style.top = y + 'px';

        const image = document.createElement('img');
        image.alt = `artefact ${i+1}`;
        image.src = encodeURI(it.src);
        fig.appendChild(image);
        canvas.appendChild(fig);

        maxRight = Math.max(maxRight, x + targetW);
        maxBottom = Math.max(maxBottom, y + targetH);
      });

      canvas.style.width = (maxRight + PAD) + 'px';
      canvas.style.height = (maxBottom + PAD) + 'px';

      if (!sessionStorage.getItem('masonry-centered')) {
        const centerX = Math.max(0, (canvas.clientWidth - viewport.clientWidth) / 2);
        const centerY = 0;
        viewport.scrollTo({ left: centerX, top: centerY, behavior: 'instant' });
        sessionStorage.setItem('masonry-centered', '1');
      }
    }

    async function init() {
      const metas = await Promise.all(IMAGES.map(preload));
      layout(metas);
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
